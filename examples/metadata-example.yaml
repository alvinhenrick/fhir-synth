# Example: Using custom metadata in FHIR resource generation
#
# This example demonstrates how to add security labels, tags, profiles,
# and other metadata to generated FHIR resources.

population:
  count: 10
  age_range: [18, 65]

rules:
  # Patient resources with global metadata
  Patient:
    resource_type: Patient
    description: Patients with custom metadata

    # Global metadata applied to ALL Patient resources from this ruleset
    global_meta:
      tag:
        - system: "http://example.org/tags"
          code: "synthetic-data"
          display: "Synthetic Test Data"
      source: "http://example.org/fhir-synth"
      profile:
        - "http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient"

    rules:
      - name: "adult_patient"
        description: "Adult patient with standard confidentiality"
        conditions:
          age_group: "adult"
        actions:
          name:
            - family: "Smith"
              given: ["John"]
          gender: "male"
          birthDate: "1980-01-01"
        weight: 1.0
        # Rule-specific metadata (merged with global_meta)
        meta:
          security:
            - system: "http://terminology.hl7.org/CodeSystem/v3-Confidentiality"
              code: "N"
              display: "Normal"

  # Conditions with sensitive data
  Condition:
    resource_type: Condition
    description: Medical conditions with restricted access

    rules:
      - name: "sensitive_condition"
        description: "HIV diagnosis - restricted access"
        conditions:
          diagnosis: "hiv"
        actions:
          code:
            coding:
              - system: "http://snomed.info/sct"
                code: "86406008"
                display: "Human immunodeficiency virus infection"
          clinicalStatus:
            coding:
              - system: "http://terminology.hl7.org/CodeSystem/condition-clinical"
                code: "active"
        weight: 1.0
        # High security for sensitive diagnoses
        meta:
          security:
            - system: "http://terminology.hl7.org/CodeSystem/v3-Confidentiality"
              code: "R"
              display: "Restricted"
            - system: "http://terminology.hl7.org/CodeSystem/v3-ActCode"
              code: "HIV"
              display: "HIV/AIDS Information"
          tag:
            - system: "http://example.org/tags"
              code: "sensitive"
              display: "Sensitive Information"
          profile:
            - "http://hl7.org/fhir/us/core/StructureDefinition/us-core-condition"

      - name: "general_condition"
        description: "General medical condition"
        actions:
          code:
            coding:
              - system: "http://snomed.info/sct"
                code: "38341003"
                display: "Hypertension"
          clinicalStatus:
            coding:
              - system: "http://terminology.hl7.org/CodeSystem/condition-clinical"
                code: "active"
        weight: 1.0
        # Normal security for general conditions
        meta:
          security:
            - system: "http://terminology.hl7.org/CodeSystem/v3-Confidentiality"
              code: "N"
              display: "Normal"

  # Observations with version tracking
  Observation:
    resource_type: Observation
    description: Observations with versioning

    global_meta:
      tag:
        - system: "http://example.org/tags"
          code: "lab-test"
      source: "http://example.org/lab-system"

    rules:
      - name: "blood_pressure"
        description: "Blood pressure measurement"
        actions:
          status: "final"
          code:
            coding:
              - system: "http://loinc.org"
                code: "85354-9"
                display: "Blood pressure panel"
          valueQuantity:
            value: 120
            unit: "mm[Hg]"
            system: "http://unitsofmeasure.org"
        weight: 1.0
        meta:
          versionId: "1.0"
          lastUpdated: "2026-02-23T12:00:00Z"
          profile:
            - "http://hl7.org/fhir/StructureDefinition/vitalsigns"

  # MedicationRequest with research tags
  MedicationRequest:
    resource_type: MedicationRequest
    description: Medication orders for research study

    global_meta:
      tag:
        - system: "http://example.org/study"
          code: "STUDY-2026-001"
          display: "Clinical Study 2026-001"
        - system: "http://example.org/tags"
          code: "research"
          display: "Research Data"
      security:
        - system: "http://terminology.hl7.org/CodeSystem/v3-Confidentiality"
          code: "N"
          display: "Normal"
      profile:
        - "http://hl7.org/fhir/us/core/StructureDefinition/us-core-medicationrequest"

    rules:
      - name: "study_medication"
        description: "Medication prescribed as part of study protocol"
        actions:
          status: "active"
          intent: "order"
          medicationCodeableConcept:
            coding:
              - system: "http://www.nlm.nih.gov/research/umls/rxnorm"
                code: "313782"
                display: "Acetaminophen 325 MG Oral Tablet"
        weight: 1.0

